# Numenta Company Website

> http://numenta.com

Source code, generators, tooling, and content for Numenta company website.
This company website is focused on our business and strategy, and is sibling to
Numenta's educational and HTM [Community](http://numenta.org) website.


## Goals

This site is an attempt to get back to the roots of a web page: *reading*.
[Inspired by](http://numenta.com/blog/2016/09/02/why-did-we-completely-change-our-website-design-the-story-behind-our-new-look/)
the classic design of [Wikipedia](https://en.wikipedia.org/wiki/Numenta), we
hope this site will be easy to read, helpful for finding information quickly,
simple to navigate, and a delight for users to interact with.

Moving from a full statically-generated multi-page website, to a single one-page
web application, is a tricky proposition. Search engine ranking can be affected,
as important internal pages and links would disappear. Navigating the user to
one of many collapsable sections on a long page can be difficult. Accessible,
legacy, and unique browsers cannot usually support the modern technology
required for single-page web applications.

To solve these challenges, while still accomplishing our goals, we have built
this as a **hybrid** website architecture. It is **both** a classic
statically-generated multi-page website, and also a modern single-page web
application. All clients load the classic static site initially, and then modern
clients will be augmented with the single-page app. This is accomplished with
the magic of ["universal" or "isomorphic" javascript](http://isomorphic.net/):
the exact same code is used to generate the static site on the server, and then
is loaded on the client to continue the app live.

[Gatsby.js](https://github.com/gatsbyjs/gatsby) helps us accomplish all of this.


## License

```
Numenta company website source code. Copyright © 2016 Numenta.
Full details in LICENSE.txt, or contact us at <http://numenta.com>.

This program is free software: you can redistribute it and/or modify it under
the terms of the GNU Affero General Public License as published by the Free
Software Foundation, either version 3 of the License, or (at your option) any
later version. This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License
for more details. You should have received a copy of the GNU Affero General
Public License along with this program. If not, see
<https://www.gnu.org/licenses/agpl.html>.
```


## Contributing

This project is open source, and
[Pull Requests](https://help.github.com/articles/about-pull-requests/) are
welcome. Contributors, please sign and submit our
[Contributor License](http://numenta.org/licenses/cl/).

If you'd like to help, please make your own fork of this repo, and work from
branches in your fork. Pull Requests should be between your fork, and our main
repo. This will keep our main repo clean of working branches.


## Environments

### Stack

* Script
  * ECMAscript [ES6](https://github.com/lukehoban/es6features) (Javascript)
    * [Node.js 6](https://nodejs.org) + [Npm 3](https://www.npmjs.com/)
    * [Babel](https://babeljs.io/) Transpiler down to older cross-browser JS
    * Babel [ESLint](http://eslint.org/) code style checking ("linting")
  * [Gatsby](https://github.com/gatsbyjs/gatsby) static site generator, wrapping:
    * [Webpack](https://webpack.github.io/) module loader/bundler, and
      [Static Generator Plugin](https://github.com/markdalgleish/static-site-generator-webpack-plugin)
    * [React.js](https://facebook.github.io/react/) reactive view components in
      [JSX](https://facebook.github.io/react/docs/jsx-in-depth.html) format
    * [Lunr](http://lunrjs.com/) client-side fulltext site search
    * Instrumented with [Google Analtyics](https://www.google.com/analytics/)
      and [Pingdom](https://www.pingdom.com/)
* Style
  * [Tachyons](http://tachyons.io/) Responsive style library, composed via
    [CSS Modules](https://github.com/css-modules/css-modules)
  * Format checking by [stylelint](https://github.com/stylelint/stylelint)
* Markup
  * [HTML5](https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/HTML5) spec
  * Style linting by [htmllint](https://github.com/htmllint/htmllint-cli)
* Assets
  * [React Icon Library](http://gorangajic.github.io/react-icons/)
  * Images: Prefer [SVG](https://en.wikipedia.org/wiki/Scalable_Vector_Graphics),
    and [PNG](https://en.wikipedia.org/wiki/Portable_Network_Graphics)
  * Icons autogenerated by
    [Favicons](https://github.com/jantimon/favicons-webpack-plugin)
    webpack plugin

### Server

#### Filesystem

```shell
.                       # https://github.com/numenta/numenta-web/numenta.com/
├── .babelrc            # Babel ES6 transpiler configuration file
├── .eslintrc.json      # ES lint rules, mostly AirBnB defaults + few tweaks
├── .stylelintrc        # CSS style lint rules
├── LICENSE.txt         # AGPLv3, more at: http://numenta.org/licenses/
├── README.md           # This file, welcome docs.
├── components/         # React.js View Components and UI modules (HTML/CSS/JS)
├── config.toml         # Configuration setings for Gatsby static site generator
├── gatsby-browser.js   # Browser-specific code, tied to React Router by Gatsby
├── gatsby-node.js      # Build-time, Node.js, Webpack & Server specific code
├── html.jsx            # Main HTML Document Component
├── node_modules/       # `npm` module install target (not in git)
├── package.json        # Project scripts, settings, and `npm` dependency lists
├── pages/              # Webpage Documents and URL Tree Structure
├── public/             # STATIC OUTPUT. Static website generated built files
├── static/             # Static html, styles, assets, etc. Copied after build.
├── utils/              # Local Helpers, utils, client, and misc code
└── wrappers/           # Document-type (.html, .md, etc.) wrapper Components
```

#### Lifecycle

@TODO - talk about how dynamic dev works, how builds work, trace how content
works it's way through components, pages, \_templates, html.jsx, webpack,
gatsby, etc, etc. Gatsby's docs have some of this to build on (and maybe we can
contribute back).

### Client

#### Lifecycle

##### Baseline

All browsers and clients will start by loading a classic, simple,
statically-generated, multi-page site. This guarantees that all users will
receive a decent baseline experience, especially on older, accessible, or unique
browsers. This also gives robots and search engine crawlers to have many
internal pages to link and index.

##### Advanced / Targets

After loading the baseline experience, modern clients (listed in the support
table below) will then be augmented with an advanced single-page style web
application. This lets us simulate a large single main page, with many
collapsable sections, much like Wikipedia. This also provides fast "no-refresh"
page transitions, a full client-side text search system, etc.

**Note:** *All versions are "Latest Stable" unless otherwise noted.*

|             | Chrome | Firefox | Safari | Edge | IE/11 | IE/10 | Android |
| ----------- |:------:|:-------:|:------:|:----:|:-----:|:-----:|:-------:|
| **Mac/OSX** |    ✓   |    ✓    |    ✓   |      |       |       |         |
| **iOS**     |        |         |    ✓   |      |       |       |         |
| **Android** |    ✓   |         |        |      |       |       |    ✓    |
| **Win/10**  |    ✓   |    ✓    |        |   ✓  |       |       |         |
| **Win/8**   |        |         |        |      |   ✓   |       |         |
| **Win/7**   |        |         |        |      |       |   ✓   |         |
| **Linux**   |    ✓   |    ✓    |        |      |       |       | &nbsp;  |


## Setup

These instructions assume latest Mac OS/X with [homebrew](http://brew.sh/)
package manager installed. Other platforms should come up just as easily.

(If you want to contribute to our project, please fork this repo, and work from
branches in that fork.)

```shell
brew install git node
git clone git@github.com:numenta/numenta-web.git
cd numenta-web/numenta.com
npm install
```


## Build

| Environment | Time  |
| ----- | -------- |
| Dynamic Development | ~20s |
| Static (Any) | ~6m |

Additional Notes:

* **Config:** Unless otherwise stated below, the `config.toml` file should have
  the default empty `linkPrefix` setting:

  ```shell
  # config.toml
  linkPrefix = ""
  ```

* **Disqus Comments:** Disqus Comments only work on Production by default, not
  under Development, Staging, etc. You can test/verify outside Prod by sending
  an override production Post URL to Disqus
  [via the component, here](https://github.com/numenta/numenta-web/blob/master/numenta.com/components/Disqus/index.jsx#L34-L40).

### Development

#### Dynamic

```shell
npm run dev
# Visit http://localhost:8000
```

Additional Notes:

* **Static Assets:** Static assets won't load correctly from `static/assets`
  during dynamic dev, but they will be fine later on staging and production
  after static build. Try the static dev (next section below) if you need the
  static asset links to work during development.

* **Specific Local IP:** If you need to host via a specific local IP (testing on
  a VM, etc.), `gatsby` options can be passed to `npm run` like this:

  ```shell
  npm run dev -- --host 192.168.1.112 --port 8765
  # Visit http://192.168.1.112:8765
  ```

* **Search:** To get search working under local dynamic development mode, you
  first need to build the search index, and then copy the index over to where it
  will be accessible by the dev webserver:

  ```shell
  npm run build
  cp public/_searchIndex.json pages/.
  ```

#### Static

```shell
npm run serve
# Visit http://localhost:8000
```

### Integration

Update Gatsby config for GitHub Pages (gh-pages) integration targets. Modify
`config.toml` and set (but DO NOT commit):

```shell
# config.toml
linkPrefix = "/numenta-web"
```

And then run an integration build:

```shell
npm run build
```

#### Personal

Push build to personal fork `origin:gh-pages` integration hosting branch:

(Note: This will remove any other gh-pages site staged on that branch).

```shell
npm run deploy:gh-pages
npm run deploy:gh-pages -- --remote origin  # same thing
# Visit http://fork.github.io/numenta-web/
```

#### Shared

Push build to shared `upstream:gh-pages` integration hosting branch:

(Note: This will remove any other gh-pages site staged on that branch).

```shell
# Deploy master branch public/ to upstream:gh-pages branch
npm run deploy:gh-pages -- --remote upstream

# Visit http://numenta.github.io/numenta-web/
```

### Staging

```shell
npm run build
# Push output to `master` branch of `NumentaCorp/numenta.com:out/` repo-path.
# Wait a few minutes for build to happen. THIS WILL CHANGE SOON.
# Visit https://staging.numenta.com
```

### Production

```shell
npm run build
# Push output to `production` branch of `NumentaCorp/numenta.com:out/` repopath.
# Wait a few minutes for build to happen. THIS WILL CHANGE SOON.
# Visit https://numenta.com
```


## Scripts

| Function | `<command>` | Notes |
| -------- | ----------- | ----- |
| Build | `npm run build` | Generate static production files |
| Clean | `npm run clean` | Clean build |
| Deploy | `npm run deploy:gh-pages` | Deploy branch `public/` build to `origin:gh-pages` |
| Develop | `npm run dev` | Develop site interactively on http://localhost:8000 |
| Lint | `npm run lint` | Check code for meeting js/css/html linting conventions |
| Serve | `npm run serve` | Builds, then Serves static output |


## Guidance

Code standards are handled by their respective linters and lint configs (for
example, see the local file `.eslintrc.json`).

### Components

* Pages and Main Sections:
  * Main Sections (pages grouped on our Wikipedia-like single-page app
    homepage) have their actual content in each pages' `pages/*/_Section.jsx`
    file
    * These main Sections are exposed as individual Pages via each pages'
      default `pages/*/index.jsx` component
  * Regular Pages (non-Main Sections) are fully contained in the usual default
    `pages/*/index.jsx` location
* Each `React` Component should return 1 small element
* Include spaces manually around React Elements in JSX with: `{' '}`
* Custom [React context](https://facebook.github.io/react/docs/context.html)
  which is available:
  * `config` = Site config (see: `config.toml`)
* Make sure to use the `prefixLink()` helper function on all internal links.
  This should be handled auto-magically for you already, but if you have trouble
  with links on staging, this may be the problem.

### Content

* Markdown link target filenames with spaces must be quoted:
  `[link text]("spaces in filename.txt")`
* Markdown YAML headmatter: be careful with quotes and escaping titles, etc.
* Beware extra Markdown
  [typographer shortcuts](https://github.com/jonschlinkert/remarkable#typographer)
* Internal flat markdown auto-links (`http://numenta.com/htm-studio/`) may break
  on staging servers, use markdown style instead:
  `[http://numenta.com/htm-studio/](/htm-studio/)`
* Search Engine Optimization (SEO) notes:
  * @TODO more basics here.
  * Make sure to follow the **URL Format** notes further below.

### Links and URLs

#### URL Format

* URLs should end with `/` (slash)
* Examples of ideal URLs detailed below:
  * `http://numenta.com/`
  * `http://numenta.com/technology-overview/`
  * `http://numenta.com/business-strategy-and-ip/#licenses`
  * etc..

#### Possible Link Situations

* @TODO list files here with lots of link/href/URL-related code. And Refactor.
* Google Analytics should be tracking `pages` and `events` for all Situations
  in the matrix below.

| Host     | Type              | .jsx Source    | .md Source     |
| -------- | ----------------- | -------------- | -------------- |
| Internal | Path              | [View][link1]  | [View][link7]  |
| Internal | Anchor            | [View][link2]  | [View][link8]  |
| Internal | Asset (/assets/*) | [View][link3]  | [View][link9]  |
| Internal | Asset (*/.pdf)    | N/A            | [View][link13] |
| External | Path              | [View][link4]  | [View][link10] |
| External | Anchor            | [View][link5]  | [View][link11] |
| External | Protocol          | [View][link6]  | [View][link12] |

[link1]: https://github.com/numenta/numenta-web/blob/master/numenta.com/pages/open-source-community/_Section.jsx#L58
[link2]: https://github.com/numenta/numenta-web/blob/master/numenta.com/pages/applications/_Section.jsx#L178
[link3]: https://github.com/numenta/numenta-web/blob/master/numenta.com/pages/applications/_Section.jsx#L248
[link4]: https://github.com/numenta/numenta-web/blob/master/numenta.com/pages/applications/_Section.jsx#L207
[link5]: https://github.com/numenta/numenta-web/blob/master/numenta.com/pages/applications/_Section.jsx#L213
[link6]: https://github.com/numenta/numenta-web/blob/master/numenta.com/pages/partners/_Section.jsx#L48
[link7]: https://github.com/numenta/numenta-web/blob/master/numenta.com/pages/blog/2016/02/11/numenta-anomaly-benchmark-contest-ieee-wcci-2016.md
[link8]: https://github.com/numenta/numenta-web/blob/master/numenta.com/pages/blog/2016/06/16/can-neuroscientists-understand-the-brain.md
[link9]: https://github.com/numenta/numenta-web/blob/master/numenta.com/pages/blog/2014/08/18/progress-at-numenta.md
[link10]: https://github.com/numenta/numenta-web/blob/master/numenta.com/pages/blog/2014/09/17/increasing-research-transparency.md
[link11]: https://github.com/numenta/numenta-web/blob/master/numenta.com/pages/blog/2013/02/11/super-bowl-neuroscience.md
[link12]: https://github.com/numenta/numenta-web/blob/master/numenta.com/pages/blog/2016/02/11/numenta-anomaly-benchmark-contest-ieee-wcci-2016.md#numenta-anomaly-benchmark-nab-competition
[link13]: https://github.com/numenta/numenta-web/blob/master/numenta.com/pages/blog/2016/03/30/numenta-at-computational-and-systems-neuroscience-conference.md

### Packages

* Use exact versions for dependencies in `package.json`, no version RegExps
  please. All package changes need be exact and on purpose for build
  reproducibility. `npm` has a `--save-exact` parameter for this:
  ```
  npm install package@1.2.34 --save --save-exact
  npm install other@5.6.7 --save-dev --save-exact
  ```
* Bump version number with each changeset: `npm version patch`
* Keep packages as up-to-date as possible. Check with: `npm outdated -depth 0`
* Update and test 1 package at a time

### Styles

* `CSS Module` Composition order:

  1. Compose from Tachyons classes
  1. Compose from Site Theme classes (Numenta colors)
  1. Compose from \_local_file_custom classes
  1. Specific custom CSS overrides

  Example:
  ```css
  ._visited:visited {
    color: #1aa0db;
  }

  .iconlink {
    composes: dim from 'tachyons';
    composes: link from 'tachyons';
    composes: color-blue from '../../assets/css/theme.css';
    composes: _visited;
    opacity: 0.5;
  }
  ```
